import Chrome from"./chrome.min.mjs";import Common from"./common.min.mjs";export default class Bookmarks{title;content;link;bookmark_user={};timestamp={};tags=[];constructor(){}static check_status(){const o=new Common;Chrome.get_storage({show_bookmarks:o.get_defaults("show_bookmarks")},(o=>{o.show_bookmarks?($(".alert-no-sections").addClass("hidden"),$(".bookmarks-tab-nav a").removeClass("hidden")):$("#bookmarks .alert-bookmarks-message").removeClass("hidden")}))}static get_bookmarks(){const o=$("#bookmarks");o.find(".bookmark-item:gt(0)").remove(),o.find(".alert-bookmarks-message").addClass("hidden"),$.getJSON(Common.get_page_url("account/bookmarks-popup?_xfResponseType=json&_xfNoRedirect=1&_xfToken="+Common.get_token()),Bookmarks.set_response)}set_tile(o){this.title=o}set_link(o){this.link=o}set_content(o){o=(o=$.trim(o)).replaceAll("\n","<br>"),this.content=o}set_timestamp(o){this.timestamp=o}set_tags(o){$(o).each(((o,t)=>{this.tags.push($(t).html())}))}static set_response(o){const t=$.parseHTML(o.html.content),e=$("#bookmarks");e.find(".alert-processing").hide(),$(t).find("li.menu-row--separated").length>0?$(t).find("li.menu-row--separated").each(((o,t)=>{const e=new Bookmarks,a={id:$(t).find(".contentRow-figure .avatar").data("user-id"),name:$(t).find(".contentRow-figure .avatar").attr("title"),avatar:$(t).find(".contentRow-figure .avatar"),link:$(t).find(".contentRow-main .contentRow-minor .username").attr("href")},n={title:$(t).find(".contentRow-main .contentRow-minor time").attr("title"),text:$(t).find(".contentRow-main .contentRow-minor time").html()};e.bookmark_user=Common.set_user(a),e.set_tile($(t).find(".contentRow-main .contentRow-title a").html()),e.set_content($(t).find(".contentRow-main .contentRow-snippet").html()),e.set_link($(t).find(".contentRow-main .contentRow-title a").attr("href")),e.set_timestamp(n),e.set_tags($(t).find(".contentRow-main .contentRow-minor .tagList .tagItem")),Common.is_background()||e.display()})):e.find(".alert-bookmarks-message").removeClass("hidden")}display(){const o=$("#bookmarks .bookmark-item:first").clone(),t=this.bookmark_user,e=this.timestamp,a=this.tags;if($(o).find(".bookmark-avatar").attr("title",t.name).attr("href",t.link),t.figure?$(o).find(".bookmark-avatar > img").attr("src",t.avatar).attr("alt",t.name):$(o).find(".bookmark-avatar > img").addClass("bg-gray-600 border border-gray-900"),$(o).find(".bookmark-title").html(this.title).attr("href",this.link),$(o).find(".bookmark-message").html(this.content),$(o).find(".bookmark-author").attr("title",t.name).attr("href",t.link).html(t.name),$(o).find(".bookmark-time").attr("title",e.title).html(e.text),a.length>0){$(o).find(".bookmark-labels").removeClass("hidden");for(let t in a){const e=$(o).find(".bookmark-label:first").clone();$(e).attr("href",Common.get_page_url("account/bookmarks?label="+a[t])).html(a[t]).removeClass("hidden").appendTo($(o).find(".bookmark-labels"))}}$(o).find(".bookmark-edit").attr("href",this.link+"bookmark"),this.set_actions(o),$(o).removeClass("hidden").appendTo("#bookmarks .bookmark-container")}set_actions(o){$(o).find(".bookmark-delete").on("click",(t=>{const e=t.currentTarget,a={delete:1,_xfToken:Common.get_token(),_xfResponseType:"json"};return t.preventDefault(),$(e).addClass("animate-pulse"),$.post(this.link+"bookmark",a,(t=>{$(e).removeClass("animate-pulse"),"ok"===t.status&&$(o).slideUp()})),!1})),$(o).find(".bookmark-copy").on("click",(o=>(o.preventDefault(),$(o.currentTarget).find("svg").addClass("text-yellow-500 hover:text-yellow-500 dark:text-yellow-500 dark:hover:text-yellow-500"),navigator.clipboard.writeText(this.link).then((()=>{setTimeout((()=>{$(o.currentTarget).find("svg").removeClass("text-yellow-500 hover:text-yellow-500 dark:text-yellow-500 dark:hover:text-yellow-500")}),1e3)})),!1)))}}