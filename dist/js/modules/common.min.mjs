import t from"./chrome.min.mjs";import e from"./laneros.min.mjs";import s from"./log.min.mjs";export default class i{page_url="https://www.laneros.com/";dark_mode=!1;active_tab="home";review_time=12e4;show_inbox=!0;show_alerts=!0;show_subscriptions=!0;show_bookmarks=!0;show_links=!0;show_user_info=!0;single_notification=!0;inbox_notification=!1;alerts_notification=!1;subscriptions_notification=!1;constructor(){}get_page_url(){return this.page_url}check_dark_mode(){t.get_storage({dark_mode:this.dark_mode},(function(t){if(t.dark_mode){let t=$(".logo-img"),e=t.attr("src");e=e.replace("2x","2x-blanco"),$("body").addClass("dark-mode"),t.attr("src",e),$("[data-dark]").each((function(t){let e=$(this).data("dark").split(",");$(this).removeClass(e[0]),$(this).addClass(e[1])}))}}))}set_ui_language(){let e=t.get_ui_language().split("-");$("html").attr("lang",e[0])}parse_messages(){$(document).find("[data-i18n]").each((function(){let[e,s]=$(this).data("i18n").split(","),i=e.split("|"),a=s.split("|");for(let e=0;e<i.length;e++){let s=i[e],o=t.get_message(a[e]);switch(s){case"html":$(this).html(o);break;default:$(this).attr(s,o)}}$(this).removeAttr("data-i18n")}))}parse_html(){let t=this.page_url;$(document).find(".external-link").each((function(){$(this).is("a")&&$(this).attr("href",t+$(this).attr("href")).attr("target","_blank"),$(this).is("form")&&$(this).attr("action",t+$(this).attr("action")),$(this).is("img")&&$(this).attr("src",t+$(this).attr("src"))}))}get_defaults(t){let e={active_tab:this.active_tab,review_time:this.review_time,dark_mode:this.dark_mode,show_inbox:this.show_inbox,show_alerts:this.show_alerts,show_subscriptions:this.show_subscriptions,show_bookmarks:this.show_bookmarks,show_links:this.show_links,show_user_info:this.show_user_info,single_notification:this.single_notification,inbox_notification:this.inbox_notification,alerts_notification:this.alerts_notification,subscriptions_notification:this.subscriptions_notification};return void 0!==t?e[t]:e}static get_time(t){try{let e=Math.floor(t/1e3),s=Math.floor(e/60),i=Math.floor(s/60);return{milliseconds:parseInt(t%1e3),seconds:parseInt(e%60),minutes:parseInt(s%60),hours:parseInt(i%60)}}catch(t){new s("Common get_time").error(t)}}static set_alarm(e){let s={name:"Laneros",options:{delayInMinutes:1,periodInMinutes:i.get_time(e).minutes}};t.create_alarm(s.name,s.options)}create_notification(e,s,i){let a=this,o=function(e,s){let i;switch(s){case 0:i=a.page_url;break;default:i=a.page_url+"account"}t.query_tab(i,(function(e){let s=e.shift();0===e.length?t.create_tab(2,i,(function(t){})):t.highlight_tab(s.windowId,s.index)}))},n=[],r={title:t.get_message("label_conversations"),message:t.get_message("message_zero_inbox")},c={title:t.get_message("label_alerts"),message:t.get_message("message_zero_alerts")},l={title:t.get_message("label_subscriptions"),message:t.get_message("message_zero_subscriptions")};e>0&&(r.message=e+" "+t.get_message("text_new_conversation")),s>0&&(c.message=s+" "+t.get_message("text_new_alert")),i>0&&(l.message=i+" "+t.get_message("text_new_subscription")),n.push(r),n.push(c),n.push(l),t.send_notification("Laneros",{type:"list",title:t.get_message("extension_name"),message:t.get_message("extension_description"),iconUrl:"../dist/img/icon.png",items:n,buttons:[{title:t.get_message("button_homepage")},{title:t.get_message("button_account")}]},(function(t){chrome.notifications.onButtonClicked.addListener(o)}),!0)}static check_data(a=!1){let o,n=new i;$(".button-options").on("click",(function(){t.create_tab(1,"views/options.html")})),$(".button-search").on("click",(function(){$(".search-form").hasClass("hidden")?($("#keywords").closest("div").find("small").addClass("invisible"),$(".search-form").removeClass("hidden").hide().slideDown((function(){$("#keywords").focus()}))):$(".search-form").slideUp((function(){$(this).addClass("hidden"),$("#keywords").val("")}))})),$(".search-form button").on("click",(function(){let e={"c[users]":"","c[newer_than]":"","c[older_than]":"","c[tags]":"","c[excludeTags]":"",order:"relevance",keywords:$("#keywords").val(),_xfToken:o,_xfResponseType:"json"};$.post(n.get_page_url()+"search/search",e,(function(e){"ok"===e.status?t.create_tab(2,e.redirect,(function(t){})):$("#keywords").closest("div").find("small").removeClass("invisible")}))})),$.get(n.page_url+"watched/threads").done((function(i,r,c){try{let s=$(".p-account .avatar",i).data("user-id"),r=parseInt($(".p-account .js-badge--conversations",i).data("badge")),c=parseInt($(".p-account .js-badge--alerts",i).data("badge")),l=parseInt($(".structItemContainer .is-unread",i).length),_=r+c+l;o=$("input[name=_xfToken]:first",i).val(),a&&new e(s,o,{conversations:r,alerts:c,subscriptions:l}),t.get_badge((function(e){e=parseInt(e),t.set_badge(_),(isNaN(e)||e<_)&&t.get_storage({single_notification:n.get_defaults("single_notification")},(function(t){t.single_notification&&n.create_notification(r,c,l)}))}))}catch(t){new s("ajax-success").error(t)}})).fail((function(t,i,a){try{$(".popup-page").css("height","auto"),403===t.status?(o=$("input[name=_xfToken]:first",t).val(),e.show_login(o)):$(".loading-box").fadeOut((function(){$(".section-error, header").removeClass("hidden")}))}catch(t){new s("Common get_data - ajax-error").error(t)}}))}}